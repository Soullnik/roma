<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Rome Budget Trip ‚Äî 14‚Äì19 Aug (Fullscreen Sidebar)</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="anonymous" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="anonymous"></script>
  <style>
    :root {
      --bg: #0f1115; --panel: #161a22; --accent: #3fb950; --muted: #8b95a7; --text: #e6edf3; --border: #283042;
      --home: #f7c351; --home-text: #111;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; background: var(--bg); color: var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    /* Fullscreen map */
    #map { position: fixed; inset: 0; z-index: 0; }
    #map .leaflet-control-container { z-index: 500; }

    /* Sidebar overlay */
    #sidebar {
      position: fixed; z-index: 1000;
      left: 12px; top: 12px; bottom: 12px;
      width: 380px; max-width: calc(100% - 24px);
      background: linear-gradient(180deg, #121722 0%, #0f1115 100%);
      border: 1px solid var(--border);
      border-radius: 14px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.45);
      overflow: auto;
      transform: translateX(0);
      transition: transform .25s ease, opacity .25s ease;
    }
    #sidebar.collapsed {
      transform: translateX(calc(-100% - 16px));
      opacity: 0.98;
    }

    .sb-head { position: sticky; top: 0; z-index: 10; padding: 10px 12px; display: flex; align-items: center; gap: 8px;
      background: #121722; border-bottom: 1px solid var(--border); border-radius: 14px 14px 0 0; }
    .sb-title { font-weight: 700; font-size: 16px; margin-right: auto; }
    .btn { padding: 8px 10px; border: 1px solid var(--border); border-radius: 10px; background: #121826; color: var(--text); font-size: 12px; }
    .btn.accent { border-color: rgba(63,185,80,0.4); color: #d7ffe2; background: rgba(63,185,80,0.12); }
    .sb-content { padding: 12px; }
    .summary { font-size: 13px; color: var(--muted); margin: 6px 0 10px; }
    .radios { display: grid; gap: 6px; margin-bottom: 10px; }
    .radios label { display: grid; grid-template-columns: 20px 1fr; gap: 8px; align-items: start; padding: 8px; border-radius: 10px; cursor: pointer; }
    .radios input[type="radio"] { accent-color: var(--accent); margin-top: 2px; }
    .radios label:hover { background: rgba(63,185,80,0.08); }
    .place { padding: 10px; border: 1px solid var(--border); border-radius: 10px; background: #0d121e; margin-bottom: 8px; }
    .place h4 { margin: 0 0 4px; font-size: 15px; }
    .place .addr { color: var(--muted); font-size: 12px; }
    .place .note { margin-top: 4px; font-size: 12px; color: #c5cedb; }
    .place .time { margin-top: 4px; font-size: 12px; color: #9ad2a8; }
    .btn-row { display: flex; gap: 8px; margin-top: 8px; flex-wrap: wrap; }

    /* Floating controls on map */
    #controls { position: fixed; right: 12px; top: 12px; z-index: 1000; display: grid; gap: 8px; }
    .fab { width: 44px; height: 44px; border-radius: 12px;
      background: rgba(22,26,34,0.95); border: 1px solid var(--border); display:flex; align-items:center; justify-content:center;
      color: var(--text); font-size: 18px; box-shadow: 0 6px 20px rgba(0,0,0,0.35); }
    .fab:active { transform: translateY(1px); }

    /* Mobile tweaks */
    @media (max-width: 900px) {
      #sidebar { width: min(92vw, 420px); }
      /* Default collapsed on mobile; JS also enforces on load */
      #open { display: block; }
    }

    /* Numbered markers */
    .num-marker { background: transparent; border: none; }
    .num-marker .dot {
      width: 30px; height: 30px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      background: var(--accent); color: #09100d; font-weight: 800; font-size: 14px;
      box-shadow: 0 0 0 2px #0d121e, 0 2px 8px rgba(0,0,0,0.4);
      transform: translate(-15px, -15px);
    }
    .num-marker.home .dot { background: var(--home); color: var(--home-text); }
    .num-marker .tail {
      position: absolute; left: 50%; top: 20px; transform: translateX(-50%);
      width: 0; height: 0; border-left: 5px solid transparent; border-right: 5px solid transparent; border-top: 8px solid var(--accent);
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.4));
    }
    .num-marker.home .tail { border-top-color: var(--home); }
  </style>
</head>
<body>
  <div id="map"></div>

  <div id="controls">
    <button id="open" class="fab" title="–ü–æ–∫–∞–∑–∞—Ç—å —Å–∞–π–¥–±–∞—Ä" style="display:none">‚ò∞</button>
    <button id="fit" class="fab" title="–ü—Ä–∏–±–ª–∏–∑–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç">üéØ</button>
    <button id="gps" class="fab" title="–ú–æ—ë –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ">üìç</button>
  </div>

  <aside id="sidebar">
    <div class="sb-head">
      <div class="sb-title">Rome 14‚Äì19 –∞–≤–≥—É—Å—Ç–∞ ‚Äî –±—é–¥–∂–µ—Ç</div>
      <button id="close" class="btn">–°–≤–µ—Ä–Ω—É—Ç—å</button>
    </div>
    <div class="sb-content">
      <div class="radios" id="day-radios"></div>
      <div id="day-info"></div>
    </div>
  </aside>

  <script>
    const ITINERARY = {"day1": {"title": "–î–µ–Ω—å 1 ‚Äî 14.08 (–≤–µ—á–µ—Ä, –ª–µ–≥–∫–æ)", "summary": "–ü–æ—Å–ª–µ –ø—Ä–∏–ª—ë—Ç–∞ (~16:00) –ª—ë–≥–∫–∞—è –ø—Ä–æ–≥—É–ª–∫–∞ —Ä—è–¥–æ–º —Å –∂–∏–ª—å—ë–º: –±–∞–∑–∏–ª–∏–∫–∞ –°–∞–Ω‚Äë–ü–∞–æ–ª–æ (–≤—Ö–æ–¥ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π), —Å—Ç—Ä–∏—Ç-–∞—Ä—Ç –û—Å—Ç–∏–µ–Ω—Å–µ, –±—é–¥–∂–µ—Ç–Ω—ã–π —É–∂–∏–Ω –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏.", "places": [{"name": "–í–∞—à–µ –∂–∏–ª—å—ë ‚Äî Viale Giustiniano Imperatore, 272", "lat": 41.85266, "lon": 12.47967, "address": "–û—Å—Ç–∏–µ–Ω—Å–µ (—Ä—è–¥–æ–º —Å Basilica San Paolo)", "note": "–°—Ç–∞—Ä—Ç–æ–≤–∞—è —Ç–æ—á–∫–∞", "time": "17:00", "isHome": true}, {"name": "Basilica di San Paolo fuori le Mura", "lat": 41.8563, "lon": 12.4769, "address": "Piazzale San Paolo, 1", "note": "–í—Ö–æ–¥ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π; –ø—Ä–æ—Ö–ª–∞–¥–Ω–æ –∏ –∫—Ä–∞—Å–∏–≤–æ.", "time": "17:20‚Äì18:10"}, {"name": "Street Art Ostiense (Via del Porto Fluviale)", "lat": 41.8706, "lon": 12.4778, "address": "Via del Porto Fluviale, 3‚Äì5", "note": "–ú—É—Ä–∞–ª—ã BLU –∏ –¥—Ä., –±–µ—Å–ø–ª–∞—Ç–Ω–æ.", "time": "18:20‚Äì19:00"}, {"name": "–£–∂–∏–Ω ‚Äî –ø–∏—Ü—Ü–∞ al taglio (–û—Å—Ç–∏–µ–Ω—Å–µ)", "lat": 41.8627, "lon": 12.482, "address": "–†–∞–π–æ–Ω Ostiense/Piramide", "note": "–ë—é–¥–∂–µ—Ç–Ω—ã–π –ø–µ—Ä–µ–∫—É—Å —Ä—è–¥–æ–º (–ø–æ –≤–∫—É—Å—É).", "time": "19:15‚Äì20:15"}]}, "day2": {"title": "–î–µ–Ω—å 2 ‚Äî 15.08 (–í–∞—Ç–∏–∫–∞–Ω –∏ —Ü–µ–Ω—Ç—Ä, –±–µ—Å–ø–ª–∞—Ç–Ω–æ)", "summary": "–£—Ç—Ä–æ–º –°–æ–±–æ—Ä –°–≤. –ü–µ—Ç—Ä–∞ (–≤—Ö–æ–¥ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π). –ó–∞—Ç–µ–º –º–æ—Å—Ç –°–∞–Ω—Ç‚Äô–ê–Ω–¥–∂–µ–ª–æ, –ù–∞–≤–æ–Ω–∞ ‚Üí –ü–∞–Ω—Ç–µ–æ–Ω (–≤–Ω—É—Ç—Ä—å ‚Ç¨5 –ø–æ –∂–µ–ª–∞–Ω–∏—é) ‚Üí –¢—Ä–µ–≤–∏ ‚Üí –ò—Å–ø–∞–Ω—Å–∫–∞—è; –Ω–∞ –∑–∞–∫–∞—Ç ‚Äî —Ç–µ—Ä—Ä–∞—Å–∞ –ü–∏–Ω—á–∏–æ.", "places": [{"name": "–í–∞—à–µ –∂–∏–ª—å—ë ‚Äî Viale Giustiniano Imperatore, 272", "lat": 41.85266, "lon": 12.47967, "address": "–û—Å—Ç–∏–µ–Ω—Å–µ (—Ä—è–¥–æ–º —Å Basilica San Paolo)", "note": "–°—Ç–∞—Ä—Ç–æ–≤–∞—è —Ç–æ—á–∫–∞", "time": "07:30", "isHome": true}, {"name": "Basilica di San Pietro", "lat": 41.9022, "lon": 12.4539, "address": "Piazza San Pietro", "note": "–í—Ö–æ–¥ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π; –æ—á–µ—Ä–µ–¥–∏ –±—ã—Å—Ç—Ä–µ–µ —Ä–∞–Ω–æ —É—Ç—Ä–æ–º.", "time": "08:15‚Äì09:30"}, {"name": "Ponte Sant'Angelo", "lat": 41.9029, "lon": 12.4663, "address": "Ponte Sant'Angelo", "note": "–í–∏–¥—ã –Ω–∞ –ó–∞–º–æ–∫ –°–≤—è—Ç–æ–≥–æ –ê–Ω–≥–µ–ª–∞.", "time": "09:40‚Äì10:00"}, {"name": "Piazza Navona", "lat": 41.8992, "lon": 12.4731, "address": "00186 Roma", "note": "–§–æ–Ω—Ç–∞–Ω—ã –ë–µ—Ä–Ω–∏–Ω–∏, —É–ª–∏—á–Ω—ã–µ –º—É–∑—ã–∫–∞–Ω—Ç—ã.", "time": "10:15‚Äì10:45"}, {"name": "Pantheon (–æ–ø—Ü. –≤–Ω—É—Ç—Ä—å ‚Ç¨5)", "lat": 41.8986, "lon": 12.4768, "address": "Piazza della Rotonda", "note": "–°–Ω–∞—Ä—É–∂–∏ –±–µ—Å–ø–ª–∞—Ç–Ω–æ; –≤–Ω—É—Ç—Ä—å –≤—Ö–æ–¥–Ω–æ–π –±–∏–ª–µ—Ç ‚Ç¨5.", "time": "10:55‚Äì11:25"}, {"name": "Fontana di Trevi", "lat": 41.9009, "lon": 12.4833, "address": "Piazza di Trevi", "note": "–õ—É—á—à–µ —É—Ç—Ä–æ–º/–≤–µ—á–µ—Ä–æ–º.", "time": "18:30‚Äì19:00"}, {"name": "Spanish Steps (Trinit√† dei Monti)", "lat": 41.9059, "lon": 12.4823, "address": "Piazza di Spagna", "note": "–ù–∞ —Å—Ç—É–ø–µ–Ω—è—Ö —Å–∏–¥–µ—Ç—å –Ω–µ–ª—å–∑—è (—à—Ç—Ä–∞—Ñ—ã).", "time": "19:10‚Äì19:30"}, {"name": "Terrazza del Pincio", "lat": 41.9105, "lon": 12.4789, "address": "Viale Gabriele D'Annunzio", "note": "–û—Ç–ª–∏—á–Ω—ã–π –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∑–∞–∫–∞—Ç–Ω—ã–π –≤–∏–¥.", "time": "19:45‚Äì20:30"}]}, "day3": {"title": "–î–µ–Ω—å 3 ‚Äî 16.08 (Palazzo Colonna + —Ä—ã–Ω–æ–∫ + –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –º—É–∑–µ–π)", "summary": "–£—Ç—Ä–æ: Palazzo Colonna (–∫–æ—Ä–æ—Ç–∫–∏–π –º–∞—Ä—à—Ä—É—Ç ‚Ç¨15; —Å—É–±–±–æ—Ç–∞ 09:15‚Äì13:15). –ó–∞—Ç–µ–º —Ä—ã–Ω–æ–∫ Trionfale –∏ Museo dell‚ÄôArte Salvata (–±–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–æ 31.08). –í–µ—á–µ—Ä–æ–º ‚Äî –¢—Ä–∞—Å—Ç–µ–≤–µ—Ä–µ –∏ –ê–ø–µ–ª—å—Å–∏–Ω–æ–≤—ã–π —Å–∞–¥.", "places": [{"name": "–í–∞—à–µ –∂–∏–ª—å—ë ‚Äî Viale Giustiniano Imperatore, 272", "lat": 41.85266, "lon": 12.47967, "address": "–û—Å—Ç–∏–µ–Ω—Å–µ (—Ä—è–¥–æ–º —Å Basilica San Paolo)", "note": "–°—Ç–∞—Ä—Ç–æ–≤–∞—è —Ç–æ—á–∫–∞", "time": "09:00", "isHome": true}, {"name": "Palazzo Colonna ‚Äî Short Itinerary (‚Ç¨15)", "lat": 41.8998, "lon": 12.4823, "address": "Via della Pilotta, 17", "note": "–°—É–±–±–æ—Ç–∞ 09:15‚Äì13:15 (–ø–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥). –ì–∞–ª–µ—Ä–µ—è + –ê–ø–ø. –ü–∏–æ + —Å–∞–¥.", "time": "09:30‚Äì11:00"}, {"name": "Mercato Trionfale", "lat": 41.9095, "lon": 12.4516, "address": "Via Andrea Doria, 3/41", "note": "–°—ã—Ä—ã, –º—è—Å–Ω—ã–µ, —Ñ—Ä—É–∫—Ç—ã; –±—é–¥–∂–µ—Ç–Ω–æ. –ó–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –æ–∫–æ–ª–æ 14:00.", "time": "11:45‚Äì12:45"}, {"name": "Museo dell‚ÄôArte Salvata (free)", "lat": 41.9029, "lon": 12.4988, "address": "Viale Enrico de Nicola, 78", "note": "–ö–æ–º–ø–ª–µ–∫—Å –¢–µ—Ä–º—ã –î–∏–æ–∫–ª–µ—Ç–∏–∞–Ω–∞; –±–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–æ 31.08.", "time": "13:15‚Äì14:15"}, {"name": "Piazza di Santa Maria in Trastevere", "lat": 41.8895, "lon": 12.4701, "address": "00153 Roma", "note": "–ê—Ç–º–æ—Å—Ñ–µ—Ä–Ω—ã–π —Ü–µ–Ω—Ç—Ä –¢—Ä–∞—Å—Ç–µ–≤–µ—Ä–µ.", "time": "18:30‚Äì19:30"}, {"name": "Giardino degli Aranci + Keyhole", "lat": 41.8799, "lon": 12.4798, "address": "Piazza dei Cavalieri di Malta, 3", "note": "–°–∞–¥ + –∑–Ω–∞–º–µ–Ω–∏—Ç–∞—è ¬´–¥—ã—Ä–æ—á–∫–∞¬ª —Å –≤–∏–¥–æ–º.", "time": "20:00‚Äì20:30"}]}, "day4": {"title": "–î–µ–Ω—å 4 ‚Äî 17.08 (Via Appia Antica, –≤–µ–ª–æ—Å–∏–ø–µ–¥—ã)", "summary": "–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ ‚Äî –ª—É—á—à–∏–π –¥–µ–Ω—å –¥–ª—è –ê–ø–ø–∏–∏ (–º–µ–Ω—å—à–µ –º–∞—à–∏–Ω). –°—Ç–∞—Ä—Ç —É Porta San Sebastiano; –≤–¥–æ–ª—å –¥—Ä–µ–≤–Ω–µ–π –¥–æ—Ä–æ–≥–∏ –∫ –ú–∞–≤–∑–æ–ª–µ—é –¶–µ—Ü–∏–ª–∏–∏ –ú–µ—Ç–µ–ª–ª—ã; –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ ‚Äî –ü–∞—Ä–∫–æ –¥–µ–ª—å–∏ –ê–∫–≤–µ–¥–æ—Ç—Ç–∏.", "places": [{"name": "–í–∞—à–µ –∂–∏–ª—å—ë ‚Äî Viale Giustiniano Imperatore, 272", "lat": 41.85266, "lon": 12.47967, "address": "–û—Å—Ç–∏–µ–Ω—Å–µ (—Ä—è–¥–æ–º —Å Basilica San Paolo)", "note": "–°—Ç–∞—Ä—Ç–æ–≤–∞—è —Ç–æ—á–∫–∞", "time": "09:00", "isHome": true}, {"name": "Porta San Sebastiano / Museo delle Mura", "lat": 41.8736, "lon": 12.4985, "address": "Via di Porta San Sebastiano, 18", "note": "–°—Ç–∞—Ä—Ç –ê–ø–ø–∏–∏, –º—É–∑–µ–π —Å—Ç–µ–Ω.", "time": "09:30‚Äì10:00"}, {"name": "Mausoleo di Cecilia Metella (—Å–Ω–∞—Ä—É–∂–∏)", "lat": 41.8396, "lon": 12.5202, "address": "Via Appia Antica, 161", "note": "–ò–∫–æ–Ω–∏—á–Ω–∞—è –≥—Ä–æ–±–Ω–∏—Ü–∞ –Ω–∞ –ê–ø–ø–∏–∏.", "time": "11:00‚Äì11:20"}, {"name": "Parco degli Acquedotti (–æ–ø—Ü.)", "lat": 41.8562, "lon": 12.5651, "address": "Via Lemonia, 256", "note": "–î—Ä–µ–≤–Ω–∏–µ –∞–∫–≤–µ–¥—É–∫–∏ —Å—Ä–µ–¥–∏ –ø–æ–ª–µ–π.", "time": "12:00‚Äì13:00"}, {"name": "Terrazza sul Foro (–≤–∏–¥ –Ω–∞ –§–æ—Ä—É–º)", "lat": 41.8928, "lon": 12.4847, "address": "Via Monte Tarpeo / Piazzale Caffarelli", "note": "–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è —Å–º–æ—Ç—Ä–æ–≤–∞—è –Ω–∞ –§–æ—Ä—É–º.", "time": "18:30‚Äì19:00"}]}, "day5": {"title": "–î–µ–Ω—å 5 ‚Äî 18.08 (–û–∑–µ—Ä–æ –ê–ª—å–±–∞–Ω–æ, –ª–æ–¥–æ—á–∫–∞)", "summary": "–ü–æ–µ–∑–¥ –¥–æ Castel Gandolfo (~40‚Äì50 –º–∏–Ω). –ù–∞ –º–µ—Å—Ç–µ ‚Äî –ø–µ–¥–∞–ª—å–Ω–∞—è –ª–æ–¥–∫–∞/–∫–∞—è–∫ (10‚Äì15 ‚Ç¨/—á–∞—Å), –º–æ–∂–Ω–æ –∫—É–ø–∞—Ç—å—Å—è. –í–µ—á–µ—Ä–æ–º ‚Äî –æ–∑–µ—Ä–æ EUR –∏ —Ä–∞–∫—É—Ä—Å –Ω–∞ –ö–æ–ª–∏–∑–µ–π.", "places": [{"name": "–í–∞—à–µ –∂–∏–ª—å—ë ‚Äî Viale Giustiniano Imperatore, 272", "lat": 41.85266, "lon": 12.47967, "address": "–û—Å—Ç–∏–µ–Ω—Å–µ (—Ä—è–¥–æ–º —Å Basilica San Paolo)", "note": "–°—Ç–∞—Ä—Ç–æ–≤–∞—è —Ç–æ—á–∫–∞", "time": "08:30", "isHome": true}, {"name": "Roma Termini (–ø–æ–µ–∑–¥ Regionale)", "lat": 41.901, "lon": 12.5018, "address": "Piazza dei Cinquecento, 1", "note": "–†–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–µ–∑–¥ –¥–æ Castel Gandolfo.", "time": "09:10‚Äì09:25"}, {"name": "Stazione Castel Gandolfo", "lat": 41.7488, "lon": 12.6501, "address": "00073 Castel Gandolfo RM", "note": "–°–ø—É—Å–∫ –∫ –æ–∑–µ—Ä—É ~20 –º–∏–Ω –ø–µ—à–∫–æ–º.", "time": "10:10‚Äì10:20"}, {"name": "Canoa/Kayak Rental ‚Äî Spiaggia del Lago", "lat": 41.7446, "lon": 12.6498, "address": "Via Spiaggia del Lago, 18", "note": "–ü–µ–¥–∞–ª—å–Ω–∞—è –ª–æ–¥–∫–∞/–∫–∞—è–∫ ~10‚Äì15 ‚Ç¨/—á–∞—Å.", "time": "10:40‚Äì12:00"}, {"name": "Laghetto dell‚ÄôEUR (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)", "lat": 41.8346, "lon": 12.4716, "address": "Viale America", "note": "–ü–∞—Ä–∫ –∏ –æ–∑–µ—Ä–æ EUR, –±–µ—Å–ø–ª–∞—Ç–Ω–æ.", "time": "18:00‚Äì19:00"}, {"name": "–í–∏–¥ –Ω–∞ –ö–æ–ª–∏–∑–µ–π ‚Äî Via Nicola Salvi", "lat": 41.8913, "lon": 12.4937, "address": "Via Nicola Salvi", "note": "–õ—É—á—à–∏–π —Ä–∞–∫—É—Ä—Å –Ω–∞ –∑–∞–∫–∞—Ç.", "time": "19:30‚Äì20:00"}]}, "day6": {"title": "–î–µ–Ω—å 6 ‚Äî 19.08 (—É—Ç—Ä–æ, –≤–Ω–µ—à–Ω–∏–π –æ—Å–º–æ—Ç—Ä –ö–æ–ª–∏–∑–µ—è)", "summary": "–§–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–µ–Ω–∞–¥–∞ –≤–æ–∫—Ä—É–≥ –ö–æ–ª–∏–∑–µ—è ‚Äî –ª—É—á—à–∏–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —Ä–∞–∫—É—Ä—Å—ã —Å–Ω–∞—Ä—É–∂–∏: Via dei Fori Imperiali, Parco del Colle Oppio, Via degli Annibaldi, Largo Gaetana Agnesi, –ê—Ä–∫–∞ –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω–∞, –ø–æ –∂–µ–ª–∞–Ω–∏—é ‚Äî –¶–∏—Ä–∫ –ú–∞–∫—Å–∏–º—É—Å.", "places": [{"name": "–í–∞—à–µ –∂–∏–ª—å—ë ‚Äî Viale Giustiniano Imperatore, 272", "lat": 41.85266, "lon": 12.47967, "address": "–û—Å—Ç–∏–µ–Ω—Å–µ (—Ä—è–¥–æ–º —Å Basilica San Paolo)", "note": "–°—Ç–∞—Ä—Ç–æ–≤–∞—è —Ç–æ—á–∫–∞", "time": "08:00", "isHome": true}, {"name": "Via dei Fori Imperiali", "lat": 41.892, "lon": 12.487, "address": "00186 Roma", "note": "–í–∏–¥ –Ω–∞ —Ñ–æ—Ä—É–º—ã –∏ –ö–æ–ª–∏–∑–µ–π.", "time": "08:30‚Äì09:00"}, {"name": "Parco del Colle Oppio ‚Äî Belvedere", "lat": 41.8936, "lon": 12.4957, "address": "Parco del Colle Oppio", "note": "–°–º–æ—Ç—Ä–æ–≤—ã–µ –Ω–∞–¥ –ö–æ–ª–∏–∑–µ–µ–º, —Ç–µ–Ω–∏—Å—Ç–æ –∏ —Ç–∏—Ö–æ.", "time": "09:05‚Äì09:35"}, {"name": "Via degli Annibaldi ‚Äî —Ä–∞–∫—É—Ä—Å", "lat": 41.8918, "lon": 12.4948, "address": "Via degli Annibaldi", "note": "–ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∞ –Ω–∞ –°–µ–≤–µ—Ä–æ‚Äë–í–æ—Å—Ç–æ–∫ –ö–æ–ª–∏–∑–µ—è.", "time": "09:40‚Äì09:55"}, {"name": "Largo Gaetana Agnesi ‚Äî –≤–∏–¥ —Å–≤–µ—Ä—Ö—É", "lat": 41.8907, "lon": 12.4939, "address": "Largo Gaetana Agnesi", "note": "–ü–ª–æ—â–∞–¥–∫–∞ –Ω–∞–¥ –º–µ—Ç—Ä–æ Colosseo (–ª–∏–Ω–∏—è B).", "time": "10:00‚Äì10:15"}, {"name": "Arco di Costantino (—Å–Ω–∞—Ä—É–∂–∏)", "lat": 41.8896, "lon": 12.4903, "address": "Piazza del Colosseo", "note": "–≠—Ñ—Ñ–µ–∫—Ç–Ω–∞—è –∞—Ä–∫–∞ —É —Å—Ç–µ–Ω –ö–æ–ª–∏–∑–µ—è.", "time": "10:20‚Äì10:35"}, {"name": "Circo Massimo (–æ–ø—Ü.)", "lat": 41.8852, "lon": 12.4882, "address": "Viale Aventino", "note": "–î—Ä–µ–≤–Ω–∏–π –∏–ø–ø–æ–¥—Ä–æ–º; –º–æ–∂–Ω–æ –Ω–∞—á–∞—Ç—å/–∑–∞–∫–æ–Ω—á–∏—Ç—å –∑–¥–µ—Å—å.", "time": "10:45‚Äì11:05"}]}};

    // Map init (fullscreen)
    const map = L.map('map', { zoomControl: true }).setView([41.896, 12.482], 12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    const dayLayers = {}, dayBounds = {}, dayMarkers = {};
    const dayOrder = Object.keys(ITINERARY);
    let currentDay = dayOrder[0];

    function createNumberedIcon(n, isHome=false) {
      const cls = isHome ? 'num-marker home' : 'num-marker';
      return L.divIcon({
        className: cls,
        html: `<div class="dot">${n}</div><div class="tail"></div>`,
        iconSize: [30, 38],
        iconAnchor: [15, 30],
        popupAnchor: [0, -28]
      });
    }

    function makePopup(place, num) {
      return `
        <div class="popup">
          <h4>${num}. ${place.name}</h4>
          ${place.address ? `<div class="muted">${place.address}</div>` : ``}
          ${place.note ? `<div style="margin-top:6px;">${place.note}</div>` : ``}
          ${place.time ? `<div class="time">üïí ${place.time}</div>` : ``}
        </div>
      `;
    }

    function buildDayLayer(dayKey) {
      const group = L.layerGroup();
      const bounds = L.latLngBounds();
      const places = ITINERARY[dayKey].places || [];
      const coords = [];
      const markers = [];

      places.forEach((p, idx) => {
        const num = idx + 1;
        const icon = createNumberedIcon(num, !!p.isHome);
        const m = L.marker([p.lat, p.lon], { icon }).bindPopup(makePopup(p, num));
        m.addTo(group);
        markers.push(m);
        bounds.extend([p.lat, p.lon]);
        coords.push([p.lat, p.lon]);
      });

      if (coords.length > 1) {
        L.polyline(coords, { weight: 3, opacity: 0.7 }).addTo(group);
      }
      dayLayers[dayKey] = group;
      dayBounds[dayKey] = bounds;
      dayMarkers[dayKey] = markers;
    }

    dayOrder.forEach(k => buildDayLayer(k));

    function fitToDay(dayKey) {
      const b = dayBounds[dayKey];
      if (b && b.isValid()) map.fitBounds(b.pad(0.15));
    }
    function focusMarker(dayKey, idx) {
      const m = (dayMarkers[dayKey] || [])[idx];
      if (!m) return;
      const latLng = m.getLatLng();
      map.setView(latLng, 16, { animate: true });
      m.openPopup();
    }

    function showDay(dayKey) {
      if (currentDay && dayLayers[currentDay]) map.removeLayer(dayLayers[currentDay]);
      dayLayers[dayKey].addTo(map);
      currentDay = dayKey;
      renderInfo(dayKey);
      fitToDay(dayKey);
    }

    // Sidebar radios + info
    const radios = document.getElementById('day-radios');
    const info = document.getElementById('day-info');

    function renderRadios() {
      radios.innerHTML = '';
      dayOrder.forEach((k, idx) => {
        const id = `r-${idx}`;
        const label = document.createElement('label');
        label.innerHTML = `
          <input type="radio" name="day" id="${id}" value="${k}" ${k===currentDay?'checked':''}>
          <div>
            <div style="font-weight:600;">${ITINERARY[k].title}</div>
            <div style="color:#8b95a7;font-size:12px;margin-top:2px;">${ITINERARY[k].summary}</div>
          </div>
        `;
        radios.appendChild(label);
      });
    }

    function renderInfo(dayKey) {
      const day = ITINERARY[dayKey];
      const placesHtml = (day.places || []).map((p, idx) => `
        <div class="place">
          <h4>${idx+1}. ${p.name}</h4>
          ${p.address ? `<div class="addr">${p.address}</div>` : ``}
          ${p.note ? `<div class="note">${p.note}</div>` : ``}
          ${p.time ? `<div class="time">üïí ${p.time}</div>` : ``}
          <div class="btn-row">
            <a class="btn accent" href="javascript:void(0)" onclick="window._focus('${dayKey}', ${idx})">–ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ</a>
            <a class="btn" href="https://maps.google.com/?q=${encodeURIComponent(p.name + ' ' + (p.address || 'Rome'))}" target="_blank" rel="noopener">–û—Ç–∫—Ä—ã—Ç—å –≤ Google Maps</a>
          </div>
        </div>
      `).join('');
      info.innerHTML = `
        <div style="font-weight:700;">${day.title}</div>
        <div class="summary">${day.summary}</div>
        <div class="btn-row" style="margin-bottom:8px;">
          <a class="btn accent" href="javascript:void(0)" onclick="window._fit('${dayKey}')">–ü—Ä–∏–±–ª–∏–∑–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç –¥–Ω—è</a>
        </div>
        ${placesHtml}
      `;
    }

    radios.addEventListener('change', (e) => {
      const v = e.target && e.target.value;
      if (!v || v===currentDay) return;
      showDay(v);
    });

    // Floating controls
    document.getElementById('fit').addEventListener('click', () => fitToDay(currentDay));
    document.getElementById('gps').addEventListener('click', () => {
      if (!navigator.geolocation) return alert('–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è.');
      navigator.geolocation.getCurrentPosition((pos) => {
        const { latitude, longitude } = pos.coords;
        const me = L.circleMarker([latitude, longitude], { radius: 8, weight: 2 }).addTo(map);
        me.bindPopup('–í—ã –∑–¥–µ—Å—å').openPopup();
        map.setView([latitude, longitude], 15, { animate: true });
      }, (err) => {
        alert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é: ' + err.message);
      }, { enableHighAccuracy: true, timeout: 8000, maximumAge: 10000 });
    });

    // Sidebar open/close
    const sidebar = document.getElementById('sidebar');
    const btnOpen = document.getElementById('open');
    const btnClose = document.getElementById('close');

    function setCollapsed(collapsed) {
      sidebar.classList.toggle('collapsed', collapsed);
      btnOpen.style.display = collapsed ? 'block' : 'none';
      setTimeout(() => map.invalidateSize(), 260);
    }

    btnOpen.addEventListener('click', () => setCollapsed(false));
    btnClose.addEventListener('click', () => setCollapsed(true));

    // Initial layout
    function init() {
      renderRadios();
      showDay(currentDay);
      const isMobile = window.matchMedia('(max-width: 900px)').matches;
      setCollapsed(isMobile); // collapsed on mobile, open on desktop
    }
    window._fit = fitToDay;
    window._focus = focusMarker;
    init();
  </script>
</body>
</html>
