<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rome Budget Trip — 14–19 Aug</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="anonymous" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="anonymous"></script>
  <style>
    :root {
      --bg: #0f1115;
      --panel: #161a22;
      --accent: #3fb950;
      --muted: #8b95a7;
      --text: #e6edf3;
      --border: #283042;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; background: var(--bg); color: var(--text); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Apple Color Emoji', 'Segoe UI Emoji'; }
    #app { display: grid; grid-template-columns: 360px 1fr; grid-template-rows: 1fr; height: 100%; }
    aside {
      background: linear-gradient(180deg, #121722 0%, #0f1115 100%);
      border-right: 1px solid var(--border);
      padding: 16px;
      overflow: auto;
    }
    .title { font-size: 18px; font-weight: 700; margin: 0 0 8px; }
    .subtitle { font-size: 13px; color: var(--muted); margin-bottom: 12px; }
    .day-selector { display: grid; gap: 6px; }
    .day-selector label { display: grid; grid-template-columns: 20px 1fr; gap: 8px; align-items: start; padding: 10px; border-radius: 12px; cursor: pointer; border: 1px solid transparent; }
    .day-selector input[type="radio"] { accent-color: var(--accent); margin-top: 2px; }
    .day-selector label:hover { background: rgba(63,185,80,0.08); border-color: rgba(63,185,80,0.25); }
    .day-title { font-weight: 600; font-size: 14px; line-height: 1.2; }
    .day-sub { font-size: 12px; color: var(--muted); margin-top: 2px; }
    .day-info { margin-top: 14px; padding: 12px; border: 1px solid var(--border); border-radius: 12px; background: #0f1320; }
    .day-info h3 { margin: 0 0 6px; font-size: 16px; }
    .day-info p { margin: 0 0 8px; color: var(--muted); line-height: 1.45; }
    .places { display: grid; gap: 8px; }
    .place { padding: 8px; border: 1px solid var(--border); border-radius: 10px; background: #0d121e; }
    .place h4 { margin: 0 0 4px; font-size: 14px; }
    .place .addr { color: var(--muted); font-size: 12px; }
    .place .note { margin-top: 4px; font-size: 12px; color: #c5cedb; }
    .btn-row { display: flex; gap: 8px; margin-top: 10px; }
    .btn { display: inline-block; padding: 8px 10px; border: 1px solid var(--border); border-radius: 10px; font-size: 12px; color: var(--text); text-decoration: none; background: #121826; cursor: pointer; }
    .btn.accent { border-color: rgba(63,185,80,0.4); color: #d7ffe2; background: rgba(63,185,80,0.12); }
    .legend { position: absolute; bottom: 16px; left: 16px; z-index: 999; background: rgba(22,26,34,0.92);
      border: 1px solid var(--border); border-radius: 12px; padding: 8px 10px; font-size: 12px; color: var(--muted); }
    #map { position: relative; }
    #map-el { width: 100%; height: 100%; }
    .popup { font-size: 13px; }
    .popup h4 { margin: 0 0 4px; font-size: 14px; color: var(--text); }
    .popup .muted { color: var(--muted); }
    @media (max-width: 900px) {
      #app { grid-template-columns: 1fr; grid-template-rows: auto 1fr; }
      aside { border-right: none; border-bottom: 1px solid var(--border); }
    }
  </style>
</head>
<body>
  <div id="app">
    <aside>
      <h1 class="title">Rome 14–19 августа — бюджет</h1>
      <div class="subtitle">Выберите день — на карте покажутся точки и маршрут только этого дня. Нажимайте на места, чтобы открыть детали.</div>
      <div class="day-selector" id="day-selector"></div>
      <div class="day-info" id="day-info"></div>
    </aside>
    <section id="map">
      <div id="map-el"></div>
      <div class="legend">OSM · Перемещайте карту, кликайте по меткам. В панеле слева — полное описание дня.</div>
    </section>
  </div>

<script>
  const ITINERARY = {"day1": {"title": "День 1 — 14.08 (вечер, легко)", "summary": "Остиенсе рядом с вашим адресом: Базилика Сан‑Паоло (вход бесплатный), стрит‑арт на Via del Porto Fluviale, бюджетный ужин на Mercato di Testaccio (до ~15:30; позже — стритфуд вокруг).", "places": [{"name": "Ваш адрес (Viale Giustiniano Imperatore, 272)", "lat": 41.85266, "lon": 12.47967, "address": "Стартовая точка", "note": ""}, {"name": "Basilica di San Paolo fuori le Mura", "lat": 41.8563, "lon": 12.4769, "address": "Piazzale San Paolo, 1", "note": "Вход бесплатный; прохладно и красиво."}, {"name": "Street Art Ostiense (Via del Porto Fluviale)", "lat": 41.8706, "lon": 12.4778, "address": "Via del Porto Fluviale, 3–5", "note": "Муралы BLU и др., бесплатно."}, {"name": "Mercato di Testaccio", "lat": 41.8765, "lon": 12.4762, "address": "Via Aldo Manuzio, 66b", "note": "Рынок до ~15:30; уличная еда и продукты недорого."}]}, "day2": {"title": "День 2 — 15.08 (Ватикан и центр, бесплатно)", "summary": "Утро: Собор Св. Петра (вход бесплатный). Дальше: мост Сант’Анджело, Пьяцца Навона → Пантеон (внутрь €5 опционально) → Треви → Испанская лестница; на закат — терраса Пинчио.", "places": [{"name": "Basilica di San Pietro", "lat": 41.9022, "lon": 12.4539, "address": "Piazza San Pietro", "note": "Вход бесплатный; очереди быстрее рано утром."}, {"name": "Ponte Sant'Angelo", "lat": 41.9029, "lon": 12.4663, "address": "Ponte Sant'Angelo", "note": "Виды на Замок Святого Ангела."}, {"name": "Piazza Navona", "lat": 41.8992, "lon": 12.4731, "address": "00186 Roma", "note": "Фонтаны Бернини, уличные музыканты."}, {"name": "Pantheon (опц. внутрь €5)", "lat": 41.8986, "lon": 12.4768, "address": "Piazza della Rotonda", "note": "Снаружи бесплатно; внутрь входной билет €5."}, {"name": "Fontana di Trevi", "lat": 41.9009, "lon": 12.4833, "address": "Piazza di Trevi", "note": "Лучше утром/вечером."}, {"name": "Spanish Steps (Trinità dei Monti)", "lat": 41.9059, "lon": 12.4823, "address": "Piazza di Spagna", "note": "На ступенях сидеть нельзя (штрафы)."}, {"name": "Terrazza del Pincio", "lat": 41.9105, "lon": 12.4789, "address": "Viale Gabriele D'Annunzio", "note": "Отличный бесплатный закатный вид."}]}, "day3": {"title": "День 3 — 16.08 (Palazzo Colonna + рынок + бесплатный музей)", "summary": "Утро: Palazzo Colonna (короткий маршрут €15; суббота 09:15–13:15). Затем рынок Trionfale и Museo dell’Arte Salvata (бесплатно до 31.08). Вечером — Трастевере и Апельсиновый сад.", "places": [{"name": "Palazzo Colonna — Short Itinerary (€15)", "lat": 41.8998, "lon": 12.4823, "address": "Via della Pilotta, 17", "note": "Суббота 09:15–13:15 (последний вход). Галерея + Апп. Пио + сад."}, {"name": "Mercato Trionfale", "lat": 41.9095, "lon": 12.4516, "address": "Via Andrea Doria, 3/41", "note": "Сыры, мясные, фрукты; бюджетно. Закрывается около 14:00."}, {"name": "Museo dell’Arte Salvata (free)", "lat": 41.9029, "lon": 12.4988, "address": "Viale Enrico de Nicola, 78", "note": "Комплекс Термы Диоклетиана; бесплатно до 31.08."}, {"name": "Piazza di Santa Maria in Trastevere", "lat": 41.8895, "lon": 12.4701, "address": "00153 Roma", "note": "Атмосферный центр Трастевере."}, {"name": "Giardino degli Aranci + Keyhole", "lat": 41.8799, "lon": 12.4798, "address": "Piazza dei Cavalieri di Malta, 3", "note": "Сад + знаменитая «дырочка» с видом."}]}, "day4": {"title": "День 4 — 17.08 (Via Appia Antica, велосипеды)", "summary": "Воскресенье — лучший день для Аппии (меньше машин). Старт у Porta San Sebastiano; вдоль древней дороги к Мавзолею Цецилии Метеллы; опционально — Парко дельи Акведотти.", "places": [{"name": "Porta San Sebastiano / Museo delle Mura", "lat": 41.8736, "lon": 12.4985, "address": "Via di Porta San Sebastiano, 18", "note": "Старт Аппии, музей стен."}, {"name": "Mausoleo di Cecilia Metella (снаружи)", "lat": 41.8396, "lon": 12.5202, "address": "Via Appia Antica, 161", "note": "Иконичная гробница на Аппии."}, {"name": "Parco degli Acquedotti (опц.)", "lat": 41.8562, "lon": 12.5651, "address": "Via Lemonia, 256", "note": "Древние акведуки среди полей."}, {"name": "Terrazza sul Foro (вид на Форум)", "lat": 41.8928, "lon": 12.4847, "address": "Via Monte Tarpeo / Piazzale Caffarelli", "note": "Бесплатная смотровая на Форум."}]}, "day5": {"title": "День 5 — 18.08 (Озеро Альбано, лодочка)", "summary": "Поезд до Castel Gandolfo (~40–50 мин). На месте — педальная лодка/каяк (10–15 €/час), можно купаться. Вечером — озеро EUR в Риме и ракурс на Колизей с Via Nicola Salvi.", "places": [{"name": "Roma Termini (поезд Regionale)", "lat": 41.901, "lon": 12.5018, "address": "Piazza dei Cinquecento, 1", "note": "Региональный поезд до Castel Gandolfo."}, {"name": "Stazione Castel Gandolfo", "lat": 41.7488, "lon": 12.6501, "address": "00073 Castel Gandolfo RM", "note": "Спуск к озеру ~20 мин пешком."}, {"name": "Canoa/Kayak Rental — Spiaggia del Lago", "lat": 41.7446, "lon": 12.6498, "address": "Via Spiaggia del Lago, 18", "note": "Педальная лодка/каяк ~10–15 €/час."}, {"name": "Laghetto dell’EUR (альтернатива)", "lat": 41.8346, "lon": 12.4716, "address": "Viale America", "note": "Парк и озеро EUR, бесплатно."}, {"name": "Вид на Колизей — Via Nicola Salvi", "lat": 41.8913, "lon": 12.4937, "address": "Via Nicola Salvi", "note": "Лучший ракурс на закат."}]}, "day6": {"title": "День 6 — 19.08 (утро, перед вылетом)", "summary": "Короткий променада: Цирк Максимус и проспект Via dei Fori Imperiali. Затем — в аэропорт.", "places": [{"name": "Circo Massimo", "lat": 41.8852, "lon": 12.4882, "address": "Viale Aventino", "note": "Древний ипподром."}, {"name": "Via dei Fori Imperiali", "lat": 41.892, "lon": 12.487, "address": "00186 Roma", "note": "Вид на форумы и Колизей."}]}};

  // Map init
  const map = L.map('map-el', { zoomControl: true }).setView([41.896, 12.482], 12);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  const dayLayers = {}, dayBounds = {};

  function makePopup(place) {
    return `
      <div class="popup">
        <h4>${place.name}</h4>
        ${place.address ? `<div class="muted">${place.address}</div>` : ``}
        ${place.note ? `<div style="margin-top:6px;">${place.note}</div>` : ``}
      </div>
    `;
  }

  function buildDayLayer(dayKey) {
    const group = L.layerGroup();
    const bounds = L.latLngBounds();
    const places = ITINERARY[dayKey].places || [];
    const coords = [];

    places.forEach((p, idx) => {
      const m = L.marker([p.lat, p.lon]).bindPopup(makePopup(p));
      m.addTo(group);
      m.on('click', () => { /* keep for potential future hooks */ });
      bounds.extend([p.lat, p.lon]);
      coords.push([p.lat, p.lon]);
    });

    if (coords.length > 1) {
      L.polyline(coords, { weight: 3, opacity: 0.7 }).addTo(group);
    }
    dayLayers[dayKey] = group;
    dayBounds[dayKey] = bounds;
  }

  const dayOrder = Object.keys(ITINERARY);
  dayOrder.forEach(k => buildDayLayer(k));

  const selector = document.getElementById('day-selector');
  const info = document.getElementById('day-info');

  function renderSelector() {
    selector.innerHTML = '';
    dayOrder.forEach((k, idx) => {
      const day = ITINERARY[k];
      const label = document.createElement('label');
      label.innerHTML = `
        <input type="radio" name="day" value="${k}" ${idx===0?'checked':''}>
        <div>
          <div class="day-title">${day.title}</div>
          <div class="day-sub">${day.summary}</div>
        </div>
      `;
      selector.appendChild(label);
    });
  }

  function renderDayInfo(dayKey) {
    const day = ITINERARY[dayKey];
    const placesHtml = (day.places || []).map((p, idx) => `
      <div class="place">
        <h4>${idx+1}. ${p.name}</h4>
        ${p.address ? `<div class="addr">${p.address}</div>` : ``}
        ${p.note ? `<div class="note">${p.note}</div>` : ``}
        <div class="btn-row">
          <a class="btn accent" href="javascript:void(0)" onclick="focusMarker('${dayKey}', ${idx})">Показать на карте</a>
          <a class="btn" href="https://maps.google.com/?q=${encodeURIComponent(p.name + ' ' + (p.address || 'Rome'))}" target="_blank" rel="noopener">Открыть в Google Maps</a>
        </div>
      </div>
    `).join('');

    info.innerHTML = `
      <h3>${day.title}</h3>
      <p>${day.summary}</p>
      <div class="btn-row">
        <a class="btn accent" href="javascript:void(0)" onclick="fitToDay('${dayKey}')">Приблизить маршрут дня</a>
      </div>
      <div class="places" style="margin-top:10px">${placesHtml}</div>
    `;
  }

  let currentDay = dayOrder[0];
  function showDay(dayKey) {
    if (currentDay && dayLayers[currentDay]) map.removeLayer(dayLayers[currentDay]);
    dayLayers[dayKey].addTo(map);
    currentDay = dayKey;
    renderDayInfo(dayKey);
    fitToDay(dayKey);
  }

  function fitToDay(dayKey) {
    const b = dayBounds[dayKey];
    if (b && b.isValid()) map.fitBounds(b.pad(0.15));
  }

  // Focus marker by index
  function focusMarker(dayKey, idx) {
    const day = ITINERARY[dayKey];
    const p = day.places[idx];
    if (!p) return;
    map.setView([p.lat, p.lon], 16, { animate: true });
    // open popup: create a temp marker to find and open popup
    // Instead, rebuild a lookup of markers:
  }

  // We'll keep a lookup of markers per day for popups
  const dayMarkers = {};
  function buildMarkersLookup() {
    dayOrder.forEach((k) => {
      const group = dayLayers[k];
      const markers = [];
      group.eachLayer((layer) => {
        if (layer instanceof L.Marker) markers.push(layer);
      });
      dayMarkers[k] = markers;
    });
  }

  // override focusMarker now that we have lookups
  window.focusMarker = function(dayKey, idx) {
    const m = (dayMarkers[dayKey] || [])[idx];
    if (!m) return;
    const latLng = m.getLatLng();
    map.setView(latLng, 16, { animate: true });
    m.openPopup();
  };
  window.fitToDay = fitToDay;

  // Init UI
  renderSelector();
  buildMarkersLookup();
  showDay(currentDay);

  // Change handler for radios (single-select)
  selector.addEventListener('change', (e) => {
    const selected = e.target && e.target.value;
    if (!selected || selected === currentDay) return;
    showDay(selected);
  });
</script>
</body>
</html>
